<!DOCTYPE html>

<html>
    <head>
        <script src="three.min.js"></script>
        <script src="ThreeCSG.js"></script>
        <script src="human.js"></script>
    </head>
    
    <body>
        <h1>"Проект, неставащ"<br><small>ф.н. 81333 &ndash; група 1 &ndash; Георги Божинов</small></h1>

        <script>
            // нагласяване на цвета и центрирането на текста с имената ви
            document.getElementsByTagName('h1')[0].style = 'color:white; text-align:left; font-size:1.75em';
            
            // рисувателно поле на цял екран
            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setClearColor(0xffffff, 1);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild( renderer.domElement );
            renderer.domElement.style = 'width:100%; height:100%; position:fixed; top:0; left:0; z-index:-1;';
            
            // сцена и камера
            scene = new THREE.Scene(background='white');
            camera = new THREE.PerspectiveCamera( 30, window.innerWidth/window.innerHeight, 0.1, 2000 );
            camera.position.set(0,3,150);

            // светлини
            var light = new THREE.DirectionalLight('lightblue',0.8);
            light.position.set(0,1,4);
            scene.add(light);
            scene.add( new THREE.AmbientLight('white',0.4) );

             // обекти за фон на сцената
            var geometry = new THREE.CylinderGeometry(1, 1, 40, 32);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/red_texture.jpeg')
            });
            var cylinder = new THREE.Mesh(geometry, material);
            cylinder.position.z = 10.5;
            cylinder.position.y = 30.5;
            scene.add(cylinder);

            var geometry = new THREE.CylinderGeometry(2, 2, 10, 32);
            var material = new THREE.MeshPhongMaterial({ color: "brown"} );
            var cylinderMic = new THREE.Mesh(geometry, material);
            cylinderMic.position.z = 10.5;
            cylinderMic.position.y = 10.5;
            scene.add(cylinderMic);
            
            var start_y = 14.5; 
            for (var i = 0; i < 5; i++) {
                var geometry = new THREE.TorusGeometry( 1.5, 1, 6, 200 );
                var material = new THREE.MeshPhongMaterial({ color: "brown" });
                var torus = new THREE.Mesh( geometry, material );
                torus.rotation.x = 1.5;
                torus.position.y = start_y; // 6.5
                torus.position.z = 10.5;
                scene.add( torus );
                start_y -= 2;
            }
            
            // текстурата на завесата
            var geometry = new THREE.BoxGeometry(190, 5, 80);
            var material = new THREE.MeshPhongMaterial( {
                map : new THREE.TextureLoader().load('textures/red_texture.jpeg')
            });
            var curtain = new THREE.Mesh( geometry, material );
            curtain.position.y = 50.5;
            curtain.rotation.x = 1.5;
            scene.add(curtain); 
            
            // сцената
            var geometry = new THREE.BoxGeometry(190, 5, 80);
            var material = new THREE.MeshPhongMaterial( {
                color : 0x000000
            });
            var stage = new THREE.Mesh( geometry, material );
            stage.position.y = 0.5;
            stage.rotation.x = 1.5;
            stage.receiveShadow = true;
            scene.add(stage); 

            var chair = new THREE.Object3D();
            scene.add(chair);
            var geometry = new THREE.BoxGeometry(10, 2, 10);
            var material = new THREE.MeshPhongMaterial( {
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            } );
            var chairBase = new THREE.Mesh ( geometry, material );
            chair.position.z = 10;
            chair.position.x = -50;
            chair.add(chairBase);
            
            var chairZ = -4; 
            for (var i = 0; i < 3; i++) {
                var geometry = new THREE.CylinderGeometry(0.8, 0.8, 8, 32);
                var material = new THREE.MeshPhongMaterial({
                    map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
                });
                var chairUpper = new THREE.Mesh( geometry, material );
                chairUpper.position.x = 4.2;
                chairUpper.position.y = 4;
                chairUpper.position.z = chairZ;
                chair.add(chairUpper);
                chairZ += 4;
            }
            
            var material = new THREE.MeshPhongMaterial( {
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            } );
            var geometry = new THREE.BoxGeometry(1, 2, 10);
            var topThing = new THREE.Mesh(geometry, material);
            
            topThing.position.z = 13.5; // 11
            topThing.position.y = 8; 
            topThing.position.x = -50;
            topThing.rotation.y = Math.PI / 2; 
            topThing.rotation.x = Math.PI / 4; 

            var chairWithThings = new THREE.Object3D();
            scene.add(chairWithThings);
            chairWithThings.add(chair);
            chairWithThings.add(topThing);
            chairWithThings.position.z = 10;

            var geometry = new THREE.CylinderGeometry(0.8, 0.8, 8, 32);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            });
            var chairLower = new THREE.Mesh( geometry, material );
            chairLower.position.x = -4.2;
            chairLower.position.y = -4;
            chairLower.position.z = -4;
            chair.add(chairLower);

            var geometry = new THREE.CylinderGeometry(0.8, 0.8, 8, 32);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            });
            var chairLower = new THREE.Mesh( geometry, material );
            chairLower.position.x = -4.2;
            chairLower.position.y = -4;
            chairLower.position.z = 4;
            chair.add(chairLower);

            var geometry = new THREE.CylinderGeometry(0.8, 0.8, 8, 32);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            });
            var chairLower = new THREE.Mesh( geometry, material );
            chairLower.position.x = 4.2;
            chairLower.position.y = -4;
            chairLower.position.z = 4;
            chair.add(chairLower);

            var geometry = new THREE.CylinderGeometry(0.8, 0.8, 8, 32);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            });
            var chairLower = new THREE.Mesh( geometry, material );
            chairLower.position.x = 4.2;
            chairLower.position.y = -4;
            chairLower.position.z = -4;
            chair.add(chairLower);

            chair.rotation.y =  Math.PI / 2;
            chair.rotation.x = Math.PI / 4;
            chairWithThings.rotation.x = -Math.PI / 6;
            chairWithThings.position.x += 20;
            chairWithThings.position.y += 10;
            chairWithThings.position.z -= 5;

            chairWithThings.receiveShadow = true;

            var spotlight = new THREE.DirectionalLight('red', 1.8);
            spotlight.position.set(6.2, -8, 3);
            spotlight.castShadow = true;
            scene.add(spotlight);

            var secondChair = chairWithThings.clone();
            secondChair.position.set(70, 8, 13);
            scene.add(secondChair);

            var geometry = new THREE.BoxGeometry(50, 3, 70);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            });
            var table = new THREE.Mesh(geometry, material);
 
            table.rotation.x = Math.PI / 8;
            table.position.x = -35;
            table.position.y = 5;

            var tableObject = new THREE.Object3D();
            scene.add(tableObject);
            tableObject.add(table);

            var material = new THREE.MeshPhongMaterial( {
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            } );
            var handle = new THREE.Mesh(new THREE.CylinderGeometry( 1.5, 1.5, 30, 100 ), material);
            handle.position.z = 25;
            handle.position.x = -59;
            handle.position.y = -22;
            handle.rotation.x = Math.PI / 8;
            tableObject.add(handle);

            var material = new THREE.MeshPhongMaterial( {
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            } );
            var handle = new THREE.Mesh(new THREE.CylinderGeometry( 1.5, 1.5, 30, 100 ), material);
            handle.position.z = 25;
            handle.position.x = -12;
            handle.position.y = -22;
            handle.rotation.x = Math.PI / 8;
            tableObject.add(handle);

            var material = new THREE.MeshPhongMaterial( {
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            } );
            var handle = new THREE.Mesh(new THREE.CylinderGeometry( 1.5, 1.5, 15, 100 ), material);
            handle.position.z = 6;
            handle.position.x = -12;
            handle.position.y = -10;
            handle.rotation.x = Math.PI / 16;
            tableObject.add(handle);

            // хора 
            манекен2 = мъжествен();
            манекен2.position.x = 30;
            манекен2.rotation.y = 3 * Math.PI / 2;
            манекен2.position.z = 50;

            // обекти върху масата
            var outer = new THREE.CylinderGeometry(2, 4, 3, 100);
            var inner = new THREE.CylinderGeometry(1.2, 4, 3, 100);

            var bspOuter = new ThreeBSP(outer);
            var bspInner = new ThreeBSP(inner);
            var bspResult = bspOuter.subtract(bspInner);
            
            var soupPlate = new THREE.Object3D();
            soupPlate.position.set(-20, 5, 20);
            scene.add(soupPlate);
            
            var plate = bspResult.toMesh(new THREE.MeshLambertMaterial({
                map : new THREE.TextureLoader().load('textures/porcelain_texture.jpeg')
            }));
            soupPlate.add(plate);

            var bottomOfPlate = new THREE.Mesh(new THREE.CylinderGeometry(1.2, 0.2, 0.2, 100), 
                    new THREE.MeshLambertMaterial({
                        map : new THREE.TextureLoader().load('textures/porcelain_texture.jpeg')
                    }));
            bottomOfPlate.position.y += 1.4;
            soupPlate.add(bottomOfPlate);
            
            // set position and rotation of soup plate
            soupPlate.rotation.x = Math.PI * 1.1;
            soupPlate.position.set(-20, 1.5, 20);

            // generate two more plates
            soupPlateTwo = soupPlate.clone();
            soupPlateTwo.position.set(-40, 1.5, 20);
            soupPlateTwo.rotation.z = Math.PI / 3;
            scene.add(soupPlateTwo); 

            // make a cup
            <!-- var geometry = new THREE.SphereGeometry( 5, 16, 12 ); -->
            <!-- geometry.applyMatrix( new THREE.Matrix4().makeScale( 1.2, 2.7, 0.5 ) ); -->
            <!-- material = new THREE.MeshPhongMaterial({color : "green"}); -->
            <!-- var mesh = new THREE.Mesh(geometry, material); -->
            <!-- mesh.position.z = 20; -->
            <!-- scene.add(mesh); -->
            
            var cup = new THREE.Object3D();
            scene.add(cup);
            cup.position.set(-28, 4, 25);
            cup.rotation.z = Math.PI;
            cup.rotation.x = Math.PI/1.7;
            cup.rotation.y = Math.PI/1.1;

            var outer = new THREE.CylinderGeometry(2, 2, 6, 100);
            var inner = new THREE.CylinderGeometry(1.3, 1.5, 6, 100);

            var bspOuter = new ThreeBSP(outer);
            var bspInner = new ThreeBSP(inner);
            var bspResult = bspOuter.subtract(bspInner);

            var cupBase = bspResult.toMesh(new THREE.MeshLambertMaterial({
                map : new THREE.TextureLoader().load('textures/porcelain_texture.jpeg')
            }));
            cup.add(cupBase);

            var cupBottom = new THREE.Mesh(new THREE.CylinderGeometry(1.3, 0.2, 0.2, 100), 
                    new THREE.MeshLambertMaterial({
                        map : new THREE.TextureLoader().load('textures/porcelain_texture.jpeg')
                    }));
            cupBottom.position.y += 2.9;
            cup.add(cupBottom);
            
            var material = new THREE.MeshLambertMaterial({
                        map : new THREE.TextureLoader().load('textures/porcelain_texture.jpeg')
                    });
            var cupHandle = new THREE.Mesh(new THREE.TorusGeometry(1.7, 0.4, 20, 80, 4), material);
            cupHandle.position.x -= 2.3;
            cupHandle.rotation.z = Math.PI/ 3;
            cup.add(cupHandle);

            cupHandle2 = cupHandle.clone();
            cup.add(cupHandle2);
            cupHandle.rotation.z = - Math.PI /1.5 ;
            cupHandle.position.x += 4.75;
        
            cup2 = cup.clone();
            cup2.position.set(-48, 4, 25);
            cup2.rotation.z = Math.PI;
            cup2.rotation.x = Math.PI/7.8;
            scene.add(cup2);
            
            // stairs
            var stairs = new THREE.Object3D();
            scene.add(stairs);
            var origPositionX = 66;
            var origPositionY = 0;
            for ( var i = 0; i < 4; i++ ){
                var geometry = new THREE.BoxGeometry(60, 8, 50);
                var material = new THREE.MeshPhongMaterial({
                    map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
                });
                var stairBase = new THREE.Mesh(geometry, material);
                stairs.rotation.x = Math.PI / 3;
                stairBase.position.y = origPositionY;
                stairBase.position.x = origPositionX;
                stairBase.position.z = 9;
                origPositionX += 6;
                origPositionY += 2.5;
                stairs.add(stairBase);
            }

            var geometry = new THREE.BoxGeometry(60, 8, 50);
            var material = new THREE.MeshPhongMaterial({
                map : new THREE.TextureLoader().load('textures/table_texture.jpeg')
            });
            var stairBase = new THREE.Mesh(geometry, material);
            <!-- stairBase.rotation.x = Math.PI / 3; -->
            stairBase.position.z = 9;
            stairBase.position.y = 10;
            stairBase.position.x = 90;
            stairs.add(stairBase);

            var thirdChair = chairWithThings.clone();
            thirdChair.scale.set = (0.5, 0.5, 0.5);
            thirdChair.position.set(55, -20, 50);
            thirdChair.rotation.y = - Math.PI/8;
            thirdChair.rotation.z = - Math.PI / 8;
            scene.add(thirdChair);

            // функция за анимиране на сцената
            var i = 81, j = 0, k = 0, t = 0;
            var flag = true, flagLeg1 = true, flagLeg2 = true, switchLeg = true;
            function drawFrame()
            {
                requestAnimationFrame( drawFrame );
                if ( flag ) {
                  if ( i == 0 ) {flag = false;}
                  else {
                    манекен2.д_ръка.врът(0, 0, -i);
                    i-=1.5;
                    манекен2.д_лакът.врът(i, 0, 0);
                  }
                } else {
                    if ( i == 81 )
                    {
                        flag = true;
                    } else {
                        манекен2.д_ръка.врът(0, 0, -i);
                        i+=1.5;
                        манекен2.д_лакът.врът(i, 0, 0);
                    }    
                }
                
                if ( манекен2.rotation.y >= 3.2 ) {
                    манекен2.rotation.y += - j / 1000;
                } 
                else if ( манекен2.position.x >= 3 ){
                    манекен2.position.x += - j / 900;
                }
                if ( манекен2.rotation.y < 3.2 && flagLeg1
                     && манекен2.position.x >= 3)
                {
                    if (k >= 35) flagLeg1 = false;
                    console.log(манекен2.д_крак.rotation.y);
                    манекен2.д_крак.врът(0, 0, -k);
                    манекен2.д_коляно.врът(0, 0, k);
                    k+=2;
                } else if (!flagLeg1){
                    if (!switchLeg)
                    {
                        if ( манекен2.rotation.y < 3.2 && flagLeg2
                             && манекен2.position.x >= 3)
                        {
                            if (t >= 35) flagLeg2 = false;
                            console.log(манекен2.д_крак.rotation.y);
                            манекен2.л_крак.врът(0, 0, -t);
                            манекен2.л_коляно.врът(0, 0, t);
                            t+=2;
                        } else if (!flagLeg2){
                            if ( t <= -5 )
                            {
                                switchLeg = true;
                                flagLeg1 = true;
                                flagLeg2 = true;
                            }
                            манекен2.л_крак.врът(0, 0, -t);
                            манекен2.л_коляно.врът(0, 0, t);
                            t -= 2;
                        }
                         
                } else {
                    if ( k <= -5 && switchLeg)
                    {
                        switchLeg = false;
                    }
                    манекен2.д_крак.врът(0, 0, -k);
                    манекен2.д_коляно.врът(0, 0, k);
                    k -= 2;
                }
              }
                j += 2;
                renderer.render( scene, camera );
            }

            // човече
            <!-- манекен = женствен(); -->
            <!-- манекен.rotation.y = 3 * Math.PI / 2; -->
            <!-- манекен.position.y = -20; -->
            <!-- манекен.position.x = 20; -->
            <!-- манекен.position.z = -40; -->
            <!-- // седнала позиция на жена -->
            drawFrame();
        </script>
    </body>
</html>
